accelerator:
  displayName: SpringBoot REST API
  description: An example showing how to build a rest API using Spring Boot & Azure Spring Apps Enterprise.
  iconUrl: https://raw.githubusercontent.com/sample-accelerators/icons/master/icon-cloud.png
  tags:
    - Java
    - Spring
    - Web
    - JPA
    - API
  options:
    - name: javaVersion
      label: "Which Java version do you want to use?"
      inputType: select
      dataType: string
      display: true
      required: true
      defaultValue: "11"
      choices:
        - text: 11
          value: "11"
        - text: 17
          value: "17"
    - name: noDB
      label: Stateless (don't generate ARM template for Azure Database for PostgreSQL - Flexible Server)
      #inputType: toggle
      display: false
      dataType: boolean
      defaultValue: false
    - name: db
      label: Configure Azure Database for PostgreSQL - Flexible Server
      display: true
      dataType: boolean
      defaultValue: false
    - name: databaseServerName
      label: Name of azure postgres Flexible server
      dataType: string
      defaultValue: ''
      dependsOn:
        name: db
    - name: databaseName
      label: Name of the postgres database
      dataType: string
      defaultValue: ''
      dependsOn:
        name: db
    - name: passwordlessConnection
      label: Use passwordless connection using Azure managed identity and RBAC
      dataType: boolean
      defaultValue: true
      dependsOn:
        name: db

engine:
  merge:
    - include: [ "**/**" ]
      exclude: [ "db/**", "stateless/**", "pom.xml", "src/main/java/com/example/QuoteRepository.java", "src/main/java/com/example/DatabaseQuoteService.java", "src/main/java/com/example/Quote.java", "src/main/resources/application.yml" ]
    - include: [ "db/**", "src/main/java/com/example/QuoteRepository.java", "src/main/java/com/example/DatabaseQuoteService.java", "src/main/java/com/example/Quote.java", "src/main/resources/application.yml"]
      condition: "#noDB == false"
    - include: [ "pom.xml" ]
      condition: "#noDB == false"
      chain:
        - type: ReplaceText
          substitutions:
            - text: sample-api-accelerator
              with: "#artifactId"
        - type: ReplaceText
          condition: "#javaVersion == '17'"
          substitutions:
            - text: 11
              with: "#javaVersion"
    - condition: "#noDB == true"
      include: [ "stateless/*.java" ]
      chain:
        - type: RewritePath
          regex: stateless/(.*)
          rewriteTo: "'src/main/java/com/example/' + #g1"
    - condition: "#noDB == true"
      include: [ "stateless/pom.xml" ]
      chain:
        - type: RewritePath
          regex: stateless/(pom.xml)
          rewriteTo: "#g1"
        - type: ReplaceText
          substitutions:
            - text: sample-api-accelerator
              with: "#artifactId"
        - type: ReplaceText
          condition: "#javaVersion == '17'"
          substitutions:
            - text: 11
              with: "#javaVersion"
    - condition: "#platform == 'tas'"
      include: [ "runtime/tas/**" ]
    - condition: "#platform == 'tap'"
      include: [ "runtime/tap/**" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: sample-api
              with: "#artifactId"


